# ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ plan_number NOT NULL Constraint

## üö® ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

### Error ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:
```
ERROR: 23502: null value in column "plan_number" of relation "installment_plans" violates not-null constraint
DETAIL: Failing row contains (bd869188-7228-4b81-8e1d-dc01d38c6cae, null, null, null, null, null, 10000.00, null, null, 10.00, null, active, 2025-08-07 04:33:33.476491+00, 2025-08-07 04:33:33.476491+00, 50000.00, 1000000.00, t, ‡∏ú‡πà‡∏≠‡∏ô 10% 36 ‡∏á‡∏ß‡∏î, 36, 30.00, 3000.00, ‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞ 36 ‡∏á‡∏ß‡∏î ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ 1..., t).
```

## üîç ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤

‡∏ï‡∏≤‡∏£‡∏≤‡∏á `installment_plans` ‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå `plan_number` ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô **NOT NULL** ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ INSERT

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á:
```sql
-- ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô (NOT NULL):
- plan_number (VARCHAR, REQUIRED) ‚ö†Ô∏è ‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢!
- interest_rate (DECIMAL, REQUIRED)
- status (VARCHAR, REQUIRED)
- branch_id (UUID, REQUIRED)
- total_amount (DECIMAL, REQUIRED) ‚ö†Ô∏è ‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢!
```

## üõ†Ô∏è ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà 1: plan_number
```sql
-- ‡πÄ‡∏î‡∏¥‡∏° (‡∏ú‡∏¥‡∏î)
INSERT INTO installment_plans (name, months, ...)

-- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡∏ñ‡∏π‡∏Å)
INSERT INTO installment_plans (plan_number, name, months, ...)
VALUES ('PLAN006', '‡∏ú‡πà‡∏≠‡∏ô 0% 6 ‡∏á‡∏ß‡∏î', 6, ...)
```

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà 2: total_amount
```sql
-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå total_amount ‡∏î‡πâ‡∏ß‡∏¢
INSERT INTO installment_plans (plan_number, ..., total_amount, ...)
VALUES ('PLAN006', ..., 10000.00, ...)
```

## üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. `simple_installment_plans_migration.sql` ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß
```sql
INSERT INTO installment_plans (
    plan_number,  -- ‚≠ê ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
    name, 
    months, 
    -- ...
)
SELECT * FROM (VALUES
    ('PLAN003', '‡∏ú‡πà‡∏≠‡∏ô 0% 3 ‡∏á‡∏ß‡∏î', 3, ...),  -- ‚≠ê ‡πÄ‡∏û‡∏¥‡πà‡∏° plan_number
    ('PLAN006', '‡∏ú‡πà‡∏≠‡∏ô 0% 6 ‡∏á‡∏ß‡∏î', 6, ...),
    -- ...
```

### 2. `safe_installment_plans_migration.sql` ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `plan_number` ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ INSERT
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `total_amount` ‡∏î‡πâ‡∏ß‡∏¢

### 3. `fixed_installment_plans_migration.sql` ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `plan_number` ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ INSERT
- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç UUID casting

### 4. `ultra_safe_installment_plans_migration.sql` üèÜ ‡πÉ‡∏´‡∏°‡πà
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `total_amount` ‡∏î‡πâ‡∏ß‡∏¢
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°

## üéØ ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ:
```sql
-- ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå ultra_safe_installment_plans_migration.sql
-- ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á plan_number ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:
```
PLAN003 - ‡∏ú‡πà‡∏≠‡∏ô 0% 3 ‡∏á‡∏ß‡∏î
PLAN006 - ‡∏ú‡πà‡∏≠‡∏ô 0% 6 ‡∏á‡∏ß‡∏î  
PLAN012 - ‡∏ú‡πà‡∏≠‡∏ô 0% 12 ‡∏á‡∏ß‡∏î
PLAN024 - ‡∏ú‡πà‡∏≠‡∏ô 8% 24 ‡∏á‡∏ß‡∏î
PLAN036 - ‡∏ú‡πà‡∏≠‡∏ô 10% 36 ‡∏á‡∏ß‡∏î
```

## üîß ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

### ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ NOT NULL Error:

#### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô:
```sql
-- ‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡πà‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π error
INSERT INTO installment_plans DEFAULT VALUES;
-- ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á error ‡∏ß‡πà‡∏≤‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÑ‡∏´‡∏ô‡πÄ‡∏õ‡πá‡∏ô NOT NULL
```

#### 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á:
```sql
SELECT column_name, is_nullable, column_default
FROM information_schema.columns 
WHERE table_name = 'installment_plans'
AND is_nullable = 'NO'
ORDER BY ordinal_position;
```

#### 3. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤ default ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô:
```sql
ALTER TABLE installment_plans 
ALTER COLUMN plan_number SET DEFAULT 'PLAN' || LPAD(nextval('plan_seq')::text, 3, '0');
```

### ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤:
```sql
-- ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
DELETE FROM installment_plans WHERE plan_number IS NULL;

-- ‡∏´‡∏£‡∏∑‡∏≠ reset ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
TRUNCATE TABLE installment_plans RESTART IDENTITY;
```

## üìù ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ

### 1. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö NOT NULL Constraints
- ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô INSERT
- ‡πÉ‡∏ä‡πâ `DEFAULT VALUES` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π required columns

### 2. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ plan_number
- ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠: `PLAN` + `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏ß‡∏î`
- ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡πÅ‡∏•‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤

### 3. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Migration ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
- ‡πÅ‡∏¢‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
- ‡∏°‡∏µ fallback plan ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ

## ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ

‡∏õ‡∏±‡∏ç‡∏´‡∏≤ `plan_number` NOT NULL ‡∏ô‡∏µ‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢:

1. **‡πÄ‡∏û‡∏¥‡πà‡∏° plan_number ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ INSERT** - ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
2. **‡πÄ‡∏û‡∏¥‡πà‡∏° total_amount ‡∏î‡πâ‡∏ß‡∏¢** - ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏µ‡∏Å‡∏ï‡∏±‡∏ß
3. **‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß** - ‡∏ó‡∏∏‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï

**‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥**: ‡πÉ‡∏ä‡πâ `ultra_safe_installment_plans_migration.sql` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î! üöÄ

## üéâ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏±‡∏ô migration ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:
```sql
SELECT plan_number, name, months, total_amount 
FROM installment_plans 
WHERE plan_number LIKE 'PLAN%';

-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
-- PLAN003 | ‡∏ú‡πà‡∏≠‡∏ô 0% 3 ‡∏á‡∏ß‡∏î  | 3  | 10000.00
-- PLAN006 | ‡∏ú‡πà‡∏≠‡∏ô 0% 6 ‡∏á‡∏ß‡∏î  | 6  | 10000.00  
-- PLAN012 | ‡∏ú‡πà‡∏≠‡∏ô 0% 12 ‡∏á‡∏ß‡∏î | 12 | 50000.00
-- PLAN024 | ‡∏ú‡πà‡∏≠‡∏ô 8% 24 ‡∏á‡∏ß‡∏î | 24 | 100000.00
-- PLAN036 | ‡∏ú‡πà‡∏≠‡∏ô 10% 36 ‡∏á‡∏ß‡∏î| 36 | 200000.00
```