<!DOCTYPE html>
<html>
<head>
    <title>Environment Variables Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
        button { padding: 10px 20px; margin: 10px 0; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üîß Environment Variables Test</h1>
    <div id="results"></div>
    
    <script type="module">
        console.log('üß™ Testing Environment Variables...');
        
        const results = document.getElementById('results');
        
        // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö environment variables
        const env = {
            VITE_SUPABASE_URL: import.meta.env.VITE_SUPABASE_URL,
            VITE_SUPABASE_ANON_KEY: import.meta.env.VITE_SUPABASE_ANON_KEY,
            VITE_SUPABASE_SERVICE_ROLE_KEY: import.meta.env.VITE_SUPABASE_SERVICE_ROLE_KEY,
            VITE_USE_SERVICE_ROLE: import.meta.env.VITE_USE_SERVICE_ROLE
        };
        
        console.log('Environment Variables:', env);
        
        let html = '<h2>üìä Environment Variables Status:</h2><ul>';
        
        for (const [key, value] of Object.entries(env)) {
            const hasValue = value && value !== 'undefined';
            const status = hasValue ? '‚úÖ' : '‚ùå';
            const className = hasValue ? 'success' : 'error';
            const displayValue = hasValue ? 
                (value.length > 50 ? value.substring(0, 50) + '...' : value) : 
                'Not Set';
            
            html += `<li class="${className}"><strong>${key}:</strong> ${status} ${displayValue}</li>`;
            
            console.log(`${key}: ${hasValue ? '‚úÖ Set' : '‚ùå Missing'}`);
        }
        
        html += '</ul>';
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        const useServiceRole = env.VITE_USE_SERVICE_ROLE === 'true';
        const selectedKey = useServiceRole ? env.VITE_SUPABASE_SERVICE_ROLE_KEY : env.VITE_SUPABASE_ANON_KEY;
        const keyType = useServiceRole ? 'Service Role Key' : 'Anon Key';
        
        html += `<h2>üîë Current Configuration:</h2>`;
        html += `<ul>`;
        html += `<li><strong>Mode:</strong> ${keyType}</li>`;
        html += `<li><strong>Service Role Enabled:</strong> ${useServiceRole ? '‚úÖ Yes' : '‚ùå No'}</li>`;
        html += `<li><strong>Selected Key Length:</strong> ${selectedKey?.length || 0} characters</li>`;
        html += `</ul>`;
        
        // ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö
        html += '<h2>üß™ Connection Test:</h2>';
        html += '<button onclick="testConnection()">Test Database Connection</button>';
        html += '<div id="connection-result"></div>';
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
        const hasValidConfig = env.VITE_SUPABASE_URL && 
                              (useServiceRole ? env.VITE_SUPABASE_SERVICE_ROLE_KEY : env.VITE_SUPABASE_ANON_KEY);
        
        if (!hasValidConfig) {
            html += `<div class="error">`;
            html += `<h2>‚ùå Configuration Issues:</h2>`;
            html += `<p>Please check your .env.local file:</p>`;
            html += `<pre>VITE_SUPABASE_URL=https://your-project-id.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key-here
VITE_SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here
VITE_USE_SERVICE_ROLE=true</pre>`;
            html += `</div>`;
        } else {
            html += `<div class="success">`;
            html += `<h2>‚úÖ Configuration OK!</h2>`;
            html += `<p>Environment variables are properly configured.</p>`;
            html += `</div>`;
        }
        
        results.innerHTML = html;
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
        window.testConnection = async function() {
            const resultDiv = document.getElementById('connection-result');
            resultDiv.innerHTML = '<p class="warning">üîÑ Testing connection...</p>';
            
            console.log('üîó Testing database connection...');
            
            try {
                if (!env.VITE_SUPABASE_URL || !selectedKey) {
                    throw new Error('Missing environment variables');
                }
                
                const { createClient } = await import('@supabase/supabase-js');
                const supabase = createClient(env.VITE_SUPABASE_URL, selectedKey, {
                    auth: {
                        autoRefreshToken: false,
                        persistSession: false
                    }
                });
                
                console.log('üì° Attempting to connect to Supabase...');
                
                const { data, error } = await supabase
                    .from('branches')
                    .select('count', { count: 'exact', head: true });
                
                if (error) {
                    console.error('‚ùå Connection error:', error);
                    resultDiv.innerHTML = `<p class="error">‚ùå Connection Error: ${error.message}</p>`;
                } else {
                    console.log('‚úÖ Connection successful!');
                    resultDiv.innerHTML = `<p class="success">‚úÖ Connection successful! Using ${keyType}</p>`;
                }
            } catch (err) {
                console.error('üí• Test failed:', err);
                resultDiv.innerHTML = `<p class="error">‚ùå Test Failed: ${err.message}</p>`;
            }
        };
        
        // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        if (hasValidConfig) {
            setTimeout(() => {
                console.log('üöÄ Running automatic connection test...');
                testConnection();
            }, 1000);
        }
    </script>
</body>
</html>