# การปรับปรุง Workflow การสร้างสัญญาผ่อนชำระและข้อมูลผู้ค้ำประกัน

## สรุปการปรับปรุง

### 1. ปรับปรุง Workflow การสร้างสัญญาใหม่

#### เดิม: 4 ขั้นตอน
- ตรวจสอบสิทธิ์
- เลือกแผนผ่อนชำระ  
- ข้อมูลเพิ่มเติม
- ตรวจสอบข้อมูล

#### ใหม่: 5 ขั้นตอน (แบบยืดหยุ่น)
1. **ข้อมูลลูกค้า** - กรอกข้อมูลลูกค้าและยอดเงิน
2. **เลือกแผนผ่อนชำระ** - เลือกแผนและตรวจสอบความต้องการผู้ค้ำ
3. **ข้อมูลผู้ค้ำประกัน** - (แสดงเฉพาะเมื่อจำเป็น)
4. **ข้อมูลเพิ่มเติม** - หลักประกัน เงื่อนไข หมายเหตุ
5. **ตรวจสอบข้อมูล** - สรุปข้อมูลทั้งหมดก่อนยืนยัน

### 2. ปรับปรุงข้อมูลลูกค้า

#### เพิ่มฟิลด์ใหม่:
- **ที่อยู่ที่ทำงาน** - สำหรับการติดตาม
- **ผู้ติดต่อฉุกเฉิน** - ชื่อ, เบอร์โทร, ความสัมพันธ์
- **ยอดเงินสัญญา** - ให้ผู้ใช้กรอกยอดเงินที่ต้องการผ่อน

#### ปรับปรุง UI:
- จัดกลุ่มข้อมูลในการ์ดแยกกัน
- เพิ่ม placeholder และคำแนะนำ
- ตรวจสอบข้อมูลที่จำเป็นก่อนไปขั้นตอนถัดไป

### 3. ระบบผู้ค้ำประกันที่ครบถ้วน

#### ข้อมูลผู้ค้ำประกันที่เพิ่ม:
- **ข้อมูลพื้นฐาน**: ชื่อ, บัตรประชาชน, เบอร์โทร, อีเมล
- **ข้อมูลการงาน**: อาชีพ, รายได้, สถานที่ทำงาน, ที่อยู่ที่ทำงาน
- **ที่อยู่**: ที่อยู่ปัจจุบัน
- **ผู้ติดต่อฉุกเฉิน**: ของผู้ค้ำประกันเอง

#### ตรรกะการตรวจสอบผู้ค้ำประกัน:
- **ยอดเงินสูง**: > 100,000 บาท
- **ระยะเวลานาน**: > 24 งวด  
- **รายได้ไม่เพียงพอ**: รายได้ต่อเดือน < 3 เท่าของค่างวด

### 4. ปรับปรุงการแสดงผล

#### Step Indicator แบบยืดหยุ่น:
- แสดง 4 ขั้นตอนเมื่อไม่ต้องการผู้ค้ำ
- แสดง 5 ขั้นตอนเมื่อต้องการผู้ค้ำ
- สีและสถานะที่ชัดเจน

#### หน้าตรวจสอบข้อมูลที่ครบถ้วน:
- **สรุปการผ่อนชำระ**: ยอดเงิน, เงินดาวน์, ค่างวด, ดอกเบี้ย
- **ข้อมูลลูกค้า**: ข้อมูลพื้นฐานและผู้ติดต่อฉุกเฉิน
- **ข้อมูลผู้ค้ำประกัน**: แสดงเฉพาะเมื่อมี
- **ข้อมูลเพิ่มเติม**: หลักประกัน, เงื่อนไข, หมายเหตุ

### 5. การปรับปรุงประสบการณ์ผู้ใช้

#### คำเตือนและการแนะนำ:
- แสดงคำเตือนเมื่อรายได้ไม่เพียงพอ
- แจ้งเหตุผลที่ต้องมีผู้ค้ำประกัน
- ตรวจสอบข้อมูลที่จำเป็นก่อนไปขั้นตอนถัดไป

#### การจัดการข้อมูล:
- อัปเดตข้อมูลอัตโนมัติเมื่อ props เปลี่ยน
- คำนวณค่าต่างๆ แบบ real-time
- ตรวจสอบความถูกต้องของข้อมูล

## ไฟล์ที่ปรับปรุง

### 1. `src/components/installments/InstallmentDialog.tsx`
- เพิ่มขั้นตอนผู้ค้ำประกัน
- ปรับปรุงฟอร์มข้อมูลลูกค้า
- เพิ่มการตรวจสอบและคำเตือน
- ปรับปรุงหน้าตรวจสอบข้อมูล

### 2. `src/pages/Installments.tsx`
- ปรับปรุงฟังก์ชันสร้างสัญญาใหม่
- เพิ่มฟังก์ชันสร้างจากลูกค้าที่มีอยู่

## ประโยชน์ที่ได้รับ

### 1. ความครบถ้วนของข้อมูล
- ข้อมูลลูกค้าและผู้ค้ำประกันที่ครบถ้วน
- ข้อมูลติดต่อฉุกเฉินสำหรับการติดตาม
- ข้อมูลการงานสำหรับการประเมินความเสี่ยง

### 2. ความยืดหยุ่นของระบบ
- แสดงขั้นตอนผู้ค้ำประกันเฉพาะเมื่อจำเป็น
- ตรวจสอบความจำเป็นแบบอัตโนมัติ
- ปรับแผนการทำงานตามสถานการณ์

### 3. ประสบการณ์ผู้ใช้ที่ดีขึ้น
- ขั้นตอนที่ชัดเจนและเป็นระบบ
- คำแนะนำและคำเตือนที่เหมาะสม
- การตรวจสอบข้อมูลก่อนยืนยัน

### 4. การจัดการความเสี่ยง
- ตรวจสอบความสามารถในการชำระ
- ข้อมูลผู้ค้ำประกันที่ครบถ้วน
- เงื่อนไขและหลักประกันที่ชัดเจน

## การใช้งาน

### สร้างสัญญาใหม่:
1. คลิก "สร้างสัญญาใหม่"
2. กรอกข้อมูลลูกค้าและยอดเงิน
3. เลือกแผนผ่อนชำระ
4. กรอกข้อมูลผู้ค้ำประกัน (ถ้าจำเป็น)
5. เพิ่มข้อมูลเพิ่มเติม
6. ตรวจสอบและยืนยันสัญญา

### การตรวจสอบอัตโนมัติ:
- ระบบจะตรวจสอบความจำเป็นของผู้ค้ำประกัน
- แสดงคำเตือนเมื่อรายได้ไม่เพียงพอ
- ตรวจสอบข้อมูลที่จำเป็นก่อนไปขั้นตอนถัดไป

## สรุป

การปรับปรุงนี้ทำให้ระบบการสร้างสัญญาผ่อนชำระมีความครบถ้วน ยืดหยุ่น และใช้งานง่ายมากขึ้น โดยเฉพาะการจัดการข้อมูลผู้ค้ำประกันที่สำคัญสำหรับการลดความเสี่ยงทางธุรกิจ